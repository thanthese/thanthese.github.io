<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Memorizer</title>
    <style>
        body {
            font-family: sans-serif;
        }

        #main {
            background-color: rgba(0, 0, 0, 0.2);
            padding: 2em 1em;
            font-size: 12pt;
            text-align: left;
            color: rgba(0, 0, 0, 0.8);
        }

        button {
            margin: 0.5em;
            padding: 0.5em;
            font-size: 12pt;
        }
    </style>
</head>
<body>
<div id="main" onclick="next();"></div>
<button onclick="previous();">Last</button>
<button onclick="reset();">Reset</button>
<script>

    const poem = `I leant upon a coppice gate
      When Frost was spectre-grey,
And Winter's dregs made desolate
      The weakening eye of day.
The tangled bine-stems scored the sky
      Like strings of broken lyres,
And all mankind that haunted nigh
      Had sought their household fires.

The land's sharp features seemed to be
      The Century's corpse outleant,
His crypt the cloudy canopy,
      The wind his death-lament.
The ancient pulse of germ and birth
      Was shrunken hard and dry,
And every spirit upon earth
      Seemed fervourless as I.

At once a voice arose among
      The bleak twigs overhead
In a full-hearted evensong
      Of joy illimited;
An aged thrush, frail, gaunt, and small,
      In blast-beruffled plume,
Had chosen thus to fling his soul
      Upon the growing gloom.

So little cause for carolings
      Of such ecstatic sound
Was written on terrestrial things
      Afar or nigh around,
That I could think there trembled through
      His happy good-night air
Some blessed Hope, whereof he knew
      And I was unaware.`;

    let chunks = [];

    function initApp(poem) {
        const poemLines = poem.replace(/ /g, "&nbsp;").split("\n");
        for (let groupSize = 1; groupSize <= 6; ++groupSize) {
            chunks = chunks.concat(getChunksByGroupSize(poemLines, groupSize));
        }
        chunks = chunks.concat(getChunksByGroupSize(poemLines, poemLines.length));
        if (!localStorage.chunkId || localStorage.chunkId > chunks.length) {
            localStorage.chunkId = 0;
        }
        draw();
    }

    function getChunksByGroupSize(lines, groupSize) {
        let c = [];
        for (let startLine = 0; startLine < lines.length; startLine += groupSize) {
            let s = "";
            for (let g = 0; g < groupSize && startLine + g < lines.length; ++g) {
                s += "&nbsp;" + lines[startLine + g] + "<br/>";
            }
            c.push(s);
        }
        return c;
    }

    function next() {
        if (localStorage.chunkId < chunks.length - 1) {
            ++localStorage.chunkId;
            draw();
        }
    }

    function previous() {
        if (localStorage.chunkId > 0) {
            --localStorage.chunkId;
            draw();
        }
    }

    function reset() {
        localStorage.chunkId = 0;
        draw();
    }

    function draw() {
        document.getElementById("main").innerHTML = chunks[localStorage.chunkId];
    }

    initApp(poem);
</script>
</body>
</html>
